parameters:
  kapitan:
    dependencies:
      - type: helm
        source: https://helm.releases.hashicorp.com
        chart_name: vault
        version: ${vault:charts:vault}
        output_path: ${vault:componentPath}/helmcharts/v${vault:charts:vault}
    compile:
      - input_paths:
          - vault/component/app.jsonnet
        input_type: jsonnet
        output_path: apps/
      - input_paths:
          - vault/component/main.jsonnet
        input_type: jsonnet
        output_path: ${_instance}/
      - input_type: helm
        output_type: yaml
        input_paths:
          - vault/helmcharts/v${vault:charts:vault}
        output_path: ${_instance}/10_vault
        helm_values: ${vault:helm_values}
        helm_params:
          release_name: ${vault:name}
          namespace: ${vault:namespace}
      - input_paths:
          - vault/component/unseal.jsonnet
        input_type: jsonnet
        output_path: ${_instance}/
      - input_paths:
          - vault/component/config.jsonnet
        input_type: jsonnet
        output_path: ${_instance}/
      - input_paths:
          - vault/component/backup.jsonnet
        input_type: jsonnet
        output_path: ${_instance}/30_backup
